---
title: "自宅から外部へサービスを公開する際に考慮しておきたい、インターネットへの接続方式について簡単なまとめ"
emoji: "🌍"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["ipv4overipv6", "dslite", "ipoe", "mape", "ISP"]
published: true
publication_name: "gmomedia"
---


## 概要
近頃のたいていのプロバイダーではIPv4 over IPv6を使ったインターネット接続方式に対応しています。
自宅から外部へWEBサービスなどを公開する際にはポート開放が必要になるケースが多いですがIPv4 over IPv6では基本的に自由にポート開放ができません。

そこで今回はインターネットへの接続方式についてざっくりと自分なりの解釈でまとめてみました。

:::message
ざっくり説明するために詳細な経路についてはだいぶ省略しています
:::

## 接続方式についてざっくり解説

### 経路と速度について
固定回線におけるインターネットへの接続方式には
従来型のPPPoE(IPv4)方式と最近主流となってきたIPoE方式の２つあります。
それぞれインターネットに接続されるまでの経路が異なります。

- PPPoE方式 (Point-to-Point Protocol over Ethernet)
従来からある一般的な接続方式で、**NTTの網終端装置(NTE)を通して**インターネットへ接続します。
メリット：**自由にポート開放ができる**
デメリット：NTTの網終端装置の収容数に限りがあるため、時間帯や地域によっては極端に通信速度が低下することがある。
※ここではPPPoE(IPv6)については触れません。

- IPoE方式(Internet Protocol over Ethernet)
近年コンシューマ向けでも主流となってきた接続方式です。
**網終端装置を通さず**、設備に余裕のあるVNE事業者を通してインターネットへ接続するため、PPPoEと比べて混雑しにくいです。
なお、IPoEは**IPv6アドレスしか使えません**
そのため、このままだとIPv4にしか対応していないサイトは接続できなくなってしまいます。
そこで出現した技術がIPv4 over IPv6です。これを使うことでIPv6の通信パケットの中でIPv4をカプセル化して通信できるため、従来のIPv4のみ対応のサイトでも接続できるようになります。

### セキュリティについて（NGNへの接続認証）
- PPPoE：IDとパスワードによるユーザ認証
- IPoE：どの回線からアクセスしてきたか、という回線認証


### IPv4 over IPv6における接続方式について
IPv4 over IPv6には3つの接続方式があります。
- MAP-E(NATステートレス) 
	- 複数家庭で１つのグローバルIPを共有。
	- あらかじめ計算された特定の範囲のポート開放ができる。80とか443は不可。
	- DTI光やビッグローブなどのv6プラスなど
- DS-Lite(NATステートフル) 
	- プライベートIPが各家庭へ配布される
	- ポートの開放は一切不可
	- 楽天ひかりやASAHIネットのv6コネクトなど
- 4rd/SAM(NATステートレス)
	- あまり詳しくないので割愛。
	
※NATステートレスの方式は自宅のルータでIPv4アドレスの変換を行います。
NATステートフルの方式は通信事業者(VNE)側でIPv4アドレスへの変換を行います。

各プロバイダ（VNE事業者）によって、IPv4 over IPv6の呼び方が異なるのがややこしいですね。
(v6プラス/IPv6オプション/v6アルファ/v6コネクトなど…)

ちなみに日本における接続方式の背景事情については総務省のこちらの資料に詳しく書かれています。
https://www.soumu.go.jp/main_content/000531613.pdf



## まとめ
色々と書きましたが、外部へWEBサービスを公開する観点でまとめると

- PPPoE
	- 80や443などのポート開放が自由できるが通信速度が**遅い**傾向にある。
	- 自分だけが使えるグローバルIPが割り当てられる（動的静的は別として）


- IPv4 over IPv6(MAP-EやDS-Lite)
	- ポート開放が自由にできないが通信速度は**早い**傾向にある。
	- グローバルIPを複数人で共用orプライベートIPが割り当てられる

ということなります。（一部ISPや法人向けのサービスを除く）

PPPoE対応ルータとIPv4 over IPv6対応のルータをうまいこと併用すればどちらの方式も
使うことが出来ますが、ネットワーク構成（物理）がややこしくなります。
しかし、一部の業務用ルータを使えば１つのルータで２つの通信方式を併用できます。
普段遣いのインターネットはIPoEを使用し、外部へ公開したいサービスはPPPoEを使うといった使い分けが可能です。
